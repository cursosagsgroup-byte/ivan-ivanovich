module.exports=[285395,e=>{"use strict";var t=e.i(317890),a=e.i(348003),r=e.i(807668),i=e.i(240224),n=e.i(919685),s=e.i(180600);let d=(0,r.default)("music-metadata:id3v2:frame-parser"),o="latin1";function c(e){return"RX"===e?"Remix":"CR"===e?"Cover":e.match(/^\d*$/)?n.Genres[Number.parseInt(e,10)]:void 0}class l{constructor(e,t){this.major=e,this.warningCollector=t}readData(e,r,n){let s;if(0===e.length)return void this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${r}`);let{encoding:g,bom:u}=i.TextEncodingToken.get(e,0),m=e.length,p=0,f=[],k=l.getNullTerminatorLength(g);switch(d(`Parsing tag type=${r}, encoding=${g}, bom=${u}`),"TXXX"!==r&&"T"===r[0]?"T*":r){case"T*":case"GRP1":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":{let t;try{t=a.decodeString(e.subarray(1),g).replace(/\x00+$/,"")}catch(e){if(e instanceof Error){this.warningCollector.addWarning(`id3v2.${this.major} type=${r} header has invalid string value: ${e.message}`);break}throw e}switch(r){case"TMCL":case"TIPL":case"IPLS":f=l.functionList(this.splitValue(r,t));break;case"TRK":case"TRCK":case"TPOS":f=t;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":f=this.splitValue(r,t);break;case"TCO":case"TCON":f=this.splitValue(r,t).map(e=>(function(e){let t,a=[],r="";for(let i of e)if("string"==typeof t)if("("===i&&""===t)r+="(",t=void 0;else if(")"===i){""!==r&&(a.push(r),r="");let e=c(t);e&&a.push(e),t=void 0}else t+=i;else"("===i?t="":r+=i;return r&&(0===a.length&&r.match(/^\d*$/)&&(r=c(r)),r&&a.push(r)),a})(e)).reduce((e,t)=>e.concat(t),[]);break;case"PCS":case"PCST":f=Array.isArray(f=this.major>=4?this.splitValue(r,t):[t])&&""===f[0]?1:0;break;default:f=this.major>=4?this.splitValue(r,t):[t]}break}case"TXXX":{let t=l.readIdentifierAndData(e,p+1,m,g);f={description:t.id,text:this.splitValue(r,a.decodeString(t.data,g).replace(/\x00+$/,""))};break}case"PIC":case"APIC":if(n){let t={};switch(p+=1,this.major){case 2:t.format=a.decodeString(e.subarray(p,p+3),"latin1"),p+=3;break;case 3:case 4:s=a.findZero(e,p,m,o),t.format=a.decodeString(e.subarray(p,s),o),p=s+1;break;default:throw function(e){throw new h(`Unexpected majorVer: ${e}`)}(this.major)}t.format=l.fixPictureMimeType(t.format),t.type=i.AttachedPictureType[e[p]],p+=1,s=a.findZero(e,p,m,g),t.description=a.decodeString(e.subarray(p,s),g),p=s+k,t.data=e.subarray(p,m),f=t}break;case"CNT":case"PCNT":f=(0,a.decodeUintBE)(e);break;case"SYLT":{let a=i.SyncTextHeader.get(e,0);p+=i.SyncTextHeader.len;let r={descriptor:"",language:a.language,contentType:a.contentType,timeStampFormat:a.timeStampFormat,syncText:[]},n=!1;for(;p<m;){let i=l.readNullTerminatedString(e.subarray(p),a.encoding);if(p+=i.len,n){let a=t.UINT32_BE.get(e,p);p+=t.UINT32_BE.len,r.syncText.push({text:i.text,timestamp:a})}else r.descriptor=i.text,n=!0}f=r;break}case"ULT":case"USLT":case"COM":case"COMM":{let t=i.TextHeader.get(e,p);p+=i.TextHeader.len;let a=l.readNullTerminatedString(e.subarray(p),t.encoding);p+=a.len;let r=l.readNullTerminatedString(e.subarray(p),t.encoding);f={language:t.language,descriptor:a.text,text:r.text};break}case"UFID":{let t=l.readIdentifierAndData(e,p,m,o);f={owner_identifier:t.id,identifier:t.data};break}case"PRIV":{let t=l.readIdentifierAndData(e,p,m,o);f={owner_identifier:t.id,data:t.data};break}case"POPM":{s=a.findZero(e,p,m,o);let r=a.decodeString(e.subarray(p,s),o),i=m-(p=s+1)-1;f={email:r,rating:t.UINT8.get(e,p),counter:i>0?a.decodeUintBE(e.subarray(p+1)):void 0};break}case"GEOB":{s=a.findZero(e,p+1,m,g);let t=a.decodeString(e.subarray(p+1,s),o);p=s+1,s=a.findZero(e,p,m,g);let r=a.decodeString(e.subarray(p,s),o);p=s+1,s=a.findZero(e,p,m,g);let i=a.decodeString(e.subarray(p,s),o);p=s+1,f={type:t,filename:r,description:i,data:e.subarray(p,m)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":s=a.findZero(e,p+1,m,g),f=a.decodeString(e.subarray(p,s),o);break;case"WXXX":{s=a.findZero(e,p+1,m,g);let t=a.decodeString(e.subarray(p+1,s),g);p=s+("utf-16le"===g?2:1),f={description:t,url:a.decodeString(e.subarray(p,m),o)};break}case"WFD":case"WFED":f=a.decodeString(e.subarray(p+1,a.findZero(e,p+1,m,g)),g);break;case"MCDI":f=e.subarray(0,m);break;default:d(`Warning: unsupported id3v2-tag-type: ${r}`)}return f}static readNullTerminatedString(e,t){let r=2*!!t.bom,i=a.findZero(e,r,e.length,t.encoding),n=e.subarray(r,i);return r="utf-16le"===t.encoding?i+2:i+1,{text:a.decodeString(n,t.encoding),len:r}}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){let t={};for(let a=0;a+1<e.length;a+=2){let r=e[a+1].split(",");t[e[a]]=t[e[a]]?t[e[a]].concat(r):r}return t}splitValue(e,t){let a;return this.major<4?(a=t.split(/\x00/g)).length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${e} uses non standard null-separator.`):a=t.split(/\//g):a=t.split(/\x00/g),l.trimArray(a)}static trimArray(e){return e.map(e=>e.replace(/\x00+$/,"").trim())}static readIdentifierAndData(e,t,r,i){let n=a.findZero(e,t,r,i),s=a.decodeString(e.subarray(t,n),i);return t=n+l.getNullTerminatorLength(i),{id:s,data:e.subarray(t,r)}}static getNullTerminatorLength(e){return"utf-16le"===e?2:1}}class h extends(0,s.makeUnexpectedFileContentError)("id3v2"){}var g=e.i(245387);class u{constructor(){this.tokenizer=void 0,this.id3Header=void 0,this.metadata=void 0,this.headerType=void 0,this.options=void 0}static removeUnsyncBytes(e){let t=0,a=0;for(;t<e.length-1;)t!==a&&(e[a]=e[t]),t+=255===e[t]&&0===e[t+1]?2:1,a++;return t<e.length&&(e[a++]=e[t]),e.subarray(0,a)}static getFrameHeaderLength(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw m(e)}}static readFrameFlags(e){return{status:{tag_alter_preservation:a.getBit(e,0,6),file_alter_preservation:a.getBit(e,0,5),read_only:a.getBit(e,0,4)},format:{grouping_identity:a.getBit(e,1,7),compression:a.getBit(e,1,3),encryption:a.getBit(e,1,2),unsynchronisation:a.getBit(e,1,1),data_length_indicator:a.getBit(e,1,0)}}}static readFrameData(e,t,a,r,i){let n=new l(a,i);switch(a){case 2:return n.readData(e,t.id,r);case 3:case 4:return t.flags?.format.unsynchronisation&&(e=u.removeUnsyncBytes(e)),t.flags?.format.data_length_indicator&&(e=e.subarray(4,e.length)),n.readData(e,t.id,r);default:throw m(a)}}static makeDescriptionTagName(e,t){return e+(t?`:${t}`:"")}async parse(e,t,a){this.tokenizer=t,this.metadata=e,this.options=a;let r=await this.tokenizer.readToken(i.ID3v2Header);if("ID3"!==r.fileIdentifier)throw new h("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=r,this.headerType=`ID3v2.${r.version.major}`,r.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(r.size)}async parseExtendedHeader(){let e=await this.tokenizer.readToken(i.ExtendedHeader),t=e.size-i.ExtendedHeader.len;return t>0?this.parseExtendedHeaderData(t,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,t){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-t)}async parseId3Data(e){let a=await this.tokenizer.readToken(new t.Uint8ArrayType(e));for(let e of this.parseMetadata(a))"TXXX"===e.id?e.value&&await this.handleTag(e,e.value.text,()=>e.value.description):await (Array.isArray(e.value)?Promise.all(e.value.map(t=>this.addTag(e.id,t))):this.addTag(e.id,e.value))}async handleTag(e,t,a,r=e=>e){await Promise.all(t.map(t=>this.addTag(u.makeDescriptionTagName(e.id,a(t)),r(t))))}async addTag(e,t){await this.metadata.addTag(this.headerType,e,t)}parseMetadata(e){let t=0,a=[];for(;t!==e.length;){let r=u.getFrameHeaderLength(this.id3Header.version.major);if(t+r>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}let i=e.subarray(t,t+r);t+=r;let n=this.readFrameHeader(i,this.id3Header.version.major),s=e.subarray(t,t+n.length);t+=n.length;let d=u.readFrameData(s,n,this.id3Header.version.major,!this.options.skipCovers,this.metadata);d&&a.push({id:n.id,value:d})}return a}readFrameHeader(e,a){let r;switch(a){case 2:(r={id:(0,g.textDecode)(e.subarray(0,3),"ascii"),length:t.UINT24_BE.get(e,3)}).id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${r.id}`);break;case 3:case 4:(r={id:(0,g.textDecode)(e.subarray(0,4),"ascii"),length:(4===a?i.UINT32SYNCSAFE:t.UINT32_BE).get(e,4),flags:u.readFrameFlags(e.subarray(8,10))}).id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${r.id}`);break;default:throw m(a)}return r}}function m(e){throw new h(`Unexpected majorVer: ${e}`)}e.s(["ID3v2Parser",()=>u],285395)},533919,e=>{"use strict";e.i(635777);var t=e.i(274749),a=e.i(317890),r=e.i(807668);let i={len:8,get:(e,t)=>({chunkID:new a.StringType(4,"latin1").get(e,t),chunkSize:a.UINT32_LE.get(e,t+4)})};class n{constructor(e){this.tagHeader=e,this.len=e.chunkSize,this.len+=1&this.len}get(e,t){return new a.StringType(this.tagHeader.chunkSize,"ascii").get(e,t)}}var s=e.i(180600);class d extends(0,s.makeUnexpectedFileContentError)("Wave"){}let o={1:"PCM",2:"ADPCM",3:"IEEE_FLOAT",5632:"MPEG_ADTS_AAC",5634:"MPEG_LOAS",255:"RAW_AAC1",146:"DOLBY_AC3_SPDIF",8192:"DVM",576:"RAW_SPORT",577:"ESST_AC3",9:"DRM",8193:"DTS2",80:"MPEG"};class c{constructor(e){if(e.chunkSize<16)throw new d("Invalid chunk size");this.len=e.chunkSize}get(e,t){return{wFormatTag:a.UINT16_LE.get(e,t),nChannels:a.UINT16_LE.get(e,t+2),nSamplesPerSec:a.UINT32_LE.get(e,t+4),nAvgBytesPerSec:a.UINT32_LE.get(e,t+8),nBlockAlign:a.UINT16_LE.get(e,t+12),wBitsPerSample:a.UINT16_LE.get(e,t+14)}}}class l{constructor(e){if(e.chunkSize<4)throw new d("Invalid fact chunk size.");this.len=e.chunkSize}get(e,t){return{dwSampleLength:a.UINT32_LE.get(e,t)}}}var h=e.i(285395),g=e.i(348003),u=e.i(830651),m=e.i(563943);let p={len:420,get:(e,t)=>({description:(0,g.stripNulls)(new a.StringType(256,"ascii").get(e,t)).trim(),originator:(0,g.stripNulls)(new a.StringType(32,"ascii").get(e,t+256)).trim(),originatorReference:(0,g.stripNulls)(new a.StringType(32,"ascii").get(e,t+288)).trim(),originationDate:(0,g.stripNulls)(new a.StringType(10,"ascii").get(e,t+320)).trim(),originationTime:(0,g.stripNulls)(new a.StringType(8,"ascii").get(e,t+330)).trim(),timeReferenceLow:a.UINT32_LE.get(e,t+338),timeReferenceHigh:a.UINT32_LE.get(e,t+342),version:a.UINT16_LE.get(e,t+346),umid:new a.Uint8ArrayType(64).get(e,t+348),loudnessValue:a.UINT16_LE.get(e,t+412),maxTruePeakLevel:a.UINT16_LE.get(e,t+414),maxMomentaryLoudness:a.UINT16_LE.get(e,t+416),maxShortTermLoudness:a.UINT16_LE.get(e,t+418)})},f=(0,r.default)("music-metadata:parser:RIFF");class k extends m.BasicParser{constructor(){super(...arguments),this.blockAlign=0}async parse(){let e=await this.tokenizer.readToken(i);if(f(`pos=${this.tokenizer.position}, parse: chunkID=${e.chunkID}`),"RIFF"===e.chunkID)return this.metadata.setAudioOnly(),this.parseRiffChunk(e.chunkSize).catch(e=>{if(!(e instanceof t.EndOfStreamError))throw e})}async parseRiffChunk(e){let t=await this.tokenizer.readToken(u.FourCcToken);if(this.metadata.setFormat("container",t),"WAVE"===t)return this.readWaveChunk(e-u.FourCcToken.len);throw new d(`Unsupported RIFF format: RIFF/${t}`)}async readWaveChunk(e){for(;e>=i.len;){let r=await this.tokenizer.readToken(i);switch(e-=i.len+r.chunkSize,r.chunkSize>e&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=r,f(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${r.chunkID}`),r.chunkID){case"LIST":await this.parseListTag(r);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new l(r));break;case"fmt ":{let e=await this.tokenizer.readToken(new c(r)),t=o[e.wFormatTag];t||(f(`WAVE/non-PCM format=${e.wFormatTag}`),t=`non-PCM (${e.wFormatTag})`),this.metadata.setFormat("codec",t),this.metadata.setFormat("bitsPerSample",e.wBitsPerSample),this.metadata.setFormat("sampleRate",e.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",e.nChannels),this.metadata.setFormat("bitrate",e.nBlockAlign*e.nSamplesPerSec*8),this.blockAlign=e.nBlockAlign;break}case"id3 ":case"ID3 ":{let e=await this.tokenizer.readToken(new a.Uint8ArrayType(r.chunkSize)),i=t.fromBuffer(e);await new h.ID3v2Parser().parse(this.metadata,i,this.options);break}case"data":{!1!==this.metadata.format.lossless&&this.metadata.setFormat("lossless",!0);let e=r.chunkSize;if(this.tokenizer.fileInfo.size){let t=this.tokenizer.fileInfo.size-this.tokenizer.position;t<e&&(this.metadata.addWarning("data chunk length exceeding file length"),e=t)}let t=this.fact?this.fact.dwSampleLength:0xffffffff===e?void 0:e/this.blockAlign;t&&(this.metadata.setFormat("numberOfSamples",t),this.metadata.format.sampleRate&&this.metadata.setFormat("duration",t/this.metadata.format.sampleRate)),"ADPCM"===this.metadata.format.codec?this.metadata.setFormat("bitrate",352e3):this.metadata.format.sampleRate&&this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(r.chunkSize);break}case"bext":{let e=await this.tokenizer.readToken(p);Object.keys(e).forEach(t=>{this.metadata.addTag("exif",`bext.${t}`,e[t])});let t=r.chunkSize-p.len;await this.tokenizer.ignore(t);break}case"\0\0\0\0":f(`Ignore padding chunk: RIFF/${r.chunkID} of ${r.chunkSize} bytes`),this.metadata.addWarning(`Ignore chunk: RIFF/${r.chunkID}`),await this.tokenizer.ignore(r.chunkSize);break;default:f(`Ignore chunk: RIFF/${r.chunkID} of ${r.chunkSize} bytes`),this.metadata.addWarning(`Ignore chunk: RIFF/${r.chunkID}`),await this.tokenizer.ignore(r.chunkSize)}this.header.chunkSize%2==1&&(f("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(e){let t=await this.tokenizer.readToken(new a.StringType(4,"latin1"));return(f("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,t),"INFO"===t)?this.parseRiffInfoTags(e.chunkSize-4):(this.metadata.addWarning(`Ignore chunk: RIFF/WAVE/LIST/${t}`),f(`Ignoring chunkID=RIFF/WAVE/LIST/${t}`),this.tokenizer.ignore(e.chunkSize-4).then())}async parseRiffInfoTags(e){for(;e>=8;){let t=await this.tokenizer.readToken(i),a=new n(t),r=await this.tokenizer.readToken(a);this.addTag(t.chunkID,g.stripNulls(r)),e-=8+a.len}if(0!==e)throw new d(`Illegal remaining size: ${e}`)}addTag(e,t){this.metadata.addTag("exif",e,t)}}e.s(["WaveParser",()=>k],533919)}];

//# sourceMappingURL=891d4_music-metadata_lib_6caccd77._.js.map