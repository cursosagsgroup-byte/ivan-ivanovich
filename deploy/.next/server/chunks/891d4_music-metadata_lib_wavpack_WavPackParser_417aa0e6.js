module.exports=[848900,e=>{"use strict";var a=e.i(317890),t=e.i(248790),i=e.i(830651),s=e.i(563943);let o=[6e3,8e3,9600,11025,12e3,16e3,22050,24e3,32e3,44100,48e3,64e3,88200,96e3,192e3,-1],r={len:32,get:(e,t)=>{let s=a.UINT32_LE.get(e,t+24),r={BlockID:i.FourCcToken.get(e,t),blockSize:a.UINT32_LE.get(e,t+4),version:a.UINT16_LE.get(e,t+8),totalSamples:a.UINT32_LE.get(e,t+12),blockIndex:a.UINT32_LE.get(e,t+16),blockSamples:a.UINT32_LE.get(e,t+20),flags:{bitsPerSample:(1+c(s,0,2))*8,isMono:l(s,2),isHybrid:l(s,3),isJointStereo:l(s,4),crossChannel:l(s,5),hybridNoiseShaping:l(s,6),floatingPoint:l(s,7),samplingRate:o[c(s,23,4)],isDSD:l(s,31)},crc:new a.Uint8ArrayType(4).get(e,t+28)};return r.flags.isDSD&&(r.totalSamples*=8),r}},n={len:1,get:(e,a)=>({functionId:c(e[a],0,6),isOptional:l(e[a],5),isOddSize:l(e[a],6),largeBlock:l(e[a],7)})};function l(e,a){return 1===c(e,a,1)}function c(e,a,t){return e>>>a&0xffffffff>>>32-t}var d=e.i(807668),k=e.i(773945),m=e.i(180600);let f=(0,d.default)("music-metadata:parser:WavPack");class h extends(0,m.makeUnexpectedFileContentError)("WavPack"){}class u extends s.BasicParser{constructor(){super(...arguments),this.audioDataSize=0}async parse(){return this.metadata.setAudioOnly(),this.audioDataSize=0,await this.parseWavPackBlocks(),(0,t.tryParseApeHeader)(this.metadata,this.tokenizer,this.options)}async parseWavPackBlocks(){do{if("wvpk"!==await this.tokenizer.peekToken(i.FourCcToken))break;let e=await this.tokenizer.readToken(r);if("wvpk"!==e.BlockID)throw new h("Invalid WavPack Block-ID");f(`WavPack header blockIndex=${e.blockIndex}, len=${r.len}`),0!==e.blockIndex||this.metadata.format.container||(this.metadata.setFormat("container","WavPack"),this.metadata.setFormat("lossless",!e.flags.isHybrid),this.metadata.setFormat("bitsPerSample",e.flags.bitsPerSample),e.flags.isDSD||(this.metadata.setFormat("sampleRate",e.flags.samplingRate),this.metadata.setFormat("duration",e.totalSamples/e.flags.samplingRate)),this.metadata.setFormat("numberOfChannels",e.flags.isMono?1:2),this.metadata.setFormat("numberOfSamples",e.totalSamples),this.metadata.setFormat("codec",e.flags.isDSD?"DSD":"PCM"));let a=e.blockSize-(r.len-8);await (0===e.blockIndex?this.parseMetadataSubBlock(e,a):this.tokenizer.ignore(a)),e.blockSamples>0&&(this.audioDataSize+=e.blockSize)}while(!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=r.len)this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioDataSize/this.metadata.format.duration)}async parseMetadataSubBlock(e,t){let i=t;for(;i>n.len;){let t=await this.tokenizer.readToken(n),s=await this.tokenizer.readNumber(t.largeBlock?a.UINT24_LE:a.UINT8),o=new Uint8Array(2*s-!!t.isOddSize);switch(await this.tokenizer.readBuffer(o),f(`Metadata Sub-Blocks functionId=0x${t.functionId.toString(16)}, id.largeBlock=${t.largeBlock},data-size=${o.length}`),t.functionId){case 0:break;case 14:{f("ID_DSD_BLOCK");let t=1<<a.UINT8.get(o,0),i=e.flags.samplingRate*t*8;if(!e.flags.isDSD)throw new h("Only expect DSD block if DSD-flag is set");this.metadata.setFormat("sampleRate",i),this.metadata.setFormat("duration",e.totalSamples/i);break}case 36:f("ID_ALT_TRAILER: trailer for non-wav files");break;case 38:this.metadata.setFormat("audioMD5",o);break;case 47:f(`ID_BLOCK_CHECKSUM: checksum=${(0,k.uint8ArrayToHex)(o)}`);break;default:f(`Ignore unsupported meta-sub-block-id functionId=0x${t.functionId.toString(16)}`)}i-=n.len+(t.largeBlock?a.UINT24_LE.len:a.UINT8.len)+2*s,f(`remainingLength=${i}`),t.isOddSize&&this.tokenizer.ignore(1)}if(0!==i)throw new h("metadata-sub-block should fit it remaining length")}}e.s(["WavPackContentError",()=>h,"WavPackParser",()=>u],848900)}];

//# sourceMappingURL=891d4_music-metadata_lib_wavpack_WavPackParser_417aa0e6.js.map