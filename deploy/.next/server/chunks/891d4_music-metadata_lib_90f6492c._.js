module.exports=[285395,e=>{"use strict";var a=e.i(317890),t=e.i(348003),r=e.i(807668),i=e.i(240224),n=e.i(919685),s=e.i(180600);let d=(0,r.default)("music-metadata:id3v2:frame-parser"),o="latin1";function c(e){return"RX"===e?"Remix":"CR"===e?"Cover":e.match(/^\d*$/)?n.Genres[Number.parseInt(e,10)]:void 0}class h{constructor(e,a){this.major=e,this.warningCollector=a}readData(e,r,n){let s;if(0===e.length)return void this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${r}`);let{encoding:u,bom:m}=i.TextEncodingToken.get(e,0),g=e.length,k=0,p=[],f=h.getNullTerminatorLength(u);switch(d(`Parsing tag type=${r}, encoding=${u}, bom=${m}`),"TXXX"!==r&&"T"===r[0]?"T*":r){case"T*":case"GRP1":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":{let a;try{a=t.decodeString(e.subarray(1),u).replace(/\x00+$/,"")}catch(e){if(e instanceof Error){this.warningCollector.addWarning(`id3v2.${this.major} type=${r} header has invalid string value: ${e.message}`);break}throw e}switch(r){case"TMCL":case"TIPL":case"IPLS":p=h.functionList(this.splitValue(r,a));break;case"TRK":case"TRCK":case"TPOS":p=a;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":p=this.splitValue(r,a);break;case"TCO":case"TCON":p=this.splitValue(r,a).map(e=>(function(e){let a,t=[],r="";for(let i of e)if("string"==typeof a)if("("===i&&""===a)r+="(",a=void 0;else if(")"===i){""!==r&&(t.push(r),r="");let e=c(a);e&&t.push(e),a=void 0}else a+=i;else"("===i?a="":r+=i;return r&&(0===t.length&&r.match(/^\d*$/)&&(r=c(r)),r&&t.push(r)),t})(e)).reduce((e,a)=>e.concat(a),[]);break;case"PCS":case"PCST":p=Array.isArray(p=this.major>=4?this.splitValue(r,a):[a])&&""===p[0]?1:0;break;default:p=this.major>=4?this.splitValue(r,a):[a]}break}case"TXXX":{let a=h.readIdentifierAndData(e,k+1,g,u);p={description:a.id,text:this.splitValue(r,t.decodeString(a.data,u).replace(/\x00+$/,""))};break}case"PIC":case"APIC":if(n){let a={};switch(k+=1,this.major){case 2:a.format=t.decodeString(e.subarray(k,k+3),"latin1"),k+=3;break;case 3:case 4:s=t.findZero(e,k,g,o),a.format=t.decodeString(e.subarray(k,s),o),k=s+1;break;default:throw function(e){throw new l(`Unexpected majorVer: ${e}`)}(this.major)}a.format=h.fixPictureMimeType(a.format),a.type=i.AttachedPictureType[e[k]],k+=1,s=t.findZero(e,k,g,u),a.description=t.decodeString(e.subarray(k,s),u),k=s+f,a.data=e.subarray(k,g),p=a}break;case"CNT":case"PCNT":p=(0,t.decodeUintBE)(e);break;case"SYLT":{let t=i.SyncTextHeader.get(e,0);k+=i.SyncTextHeader.len;let r={descriptor:"",language:t.language,contentType:t.contentType,timeStampFormat:t.timeStampFormat,syncText:[]},n=!1;for(;k<g;){let i=h.readNullTerminatedString(e.subarray(k),t.encoding);if(k+=i.len,n){let t=a.UINT32_BE.get(e,k);k+=a.UINT32_BE.len,r.syncText.push({text:i.text,timestamp:t})}else r.descriptor=i.text,n=!0}p=r;break}case"ULT":case"USLT":case"COM":case"COMM":{let a=i.TextHeader.get(e,k);k+=i.TextHeader.len;let t=h.readNullTerminatedString(e.subarray(k),a.encoding);k+=t.len;let r=h.readNullTerminatedString(e.subarray(k),a.encoding);p={language:a.language,descriptor:t.text,text:r.text};break}case"UFID":{let a=h.readIdentifierAndData(e,k,g,o);p={owner_identifier:a.id,identifier:a.data};break}case"PRIV":{let a=h.readIdentifierAndData(e,k,g,o);p={owner_identifier:a.id,data:a.data};break}case"POPM":{s=t.findZero(e,k,g,o);let r=t.decodeString(e.subarray(k,s),o),i=g-(k=s+1)-1;p={email:r,rating:a.UINT8.get(e,k),counter:i>0?t.decodeUintBE(e.subarray(k+1)):void 0};break}case"GEOB":{s=t.findZero(e,k+1,g,u);let a=t.decodeString(e.subarray(k+1,s),o);k=s+1,s=t.findZero(e,k,g,u);let r=t.decodeString(e.subarray(k,s),o);k=s+1,s=t.findZero(e,k,g,u);let i=t.decodeString(e.subarray(k,s),o);k=s+1,p={type:a,filename:r,description:i,data:e.subarray(k,g)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":s=t.findZero(e,k+1,g,u),p=t.decodeString(e.subarray(k,s),o);break;case"WXXX":{s=t.findZero(e,k+1,g,u);let a=t.decodeString(e.subarray(k+1,s),u);k=s+("utf-16le"===u?2:1),p={description:a,url:t.decodeString(e.subarray(k,g),o)};break}case"WFD":case"WFED":p=t.decodeString(e.subarray(k+1,t.findZero(e,k+1,g,u)),u);break;case"MCDI":p=e.subarray(0,g);break;default:d(`Warning: unsupported id3v2-tag-type: ${r}`)}return p}static readNullTerminatedString(e,a){let r=2*!!a.bom,i=t.findZero(e,r,e.length,a.encoding),n=e.subarray(r,i);return r="utf-16le"===a.encoding?i+2:i+1,{text:t.decodeString(n,a.encoding),len:r}}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){let a={};for(let t=0;t+1<e.length;t+=2){let r=e[t+1].split(",");a[e[t]]=a[e[t]]?a[e[t]].concat(r):r}return a}splitValue(e,a){let t;return this.major<4?(t=a.split(/\x00/g)).length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${e} uses non standard null-separator.`):t=a.split(/\//g):t=a.split(/\x00/g),h.trimArray(t)}static trimArray(e){return e.map(e=>e.replace(/\x00+$/,"").trim())}static readIdentifierAndData(e,a,r,i){let n=t.findZero(e,a,r,i),s=t.decodeString(e.subarray(a,n),i);return a=n+h.getNullTerminatorLength(i),{id:s,data:e.subarray(a,r)}}static getNullTerminatorLength(e){return"utf-16le"===e?2:1}}class l extends(0,s.makeUnexpectedFileContentError)("id3v2"){}var u=e.i(245387);class m{constructor(){this.tokenizer=void 0,this.id3Header=void 0,this.metadata=void 0,this.headerType=void 0,this.options=void 0}static removeUnsyncBytes(e){let a=0,t=0;for(;a<e.length-1;)a!==t&&(e[t]=e[a]),a+=255===e[a]&&0===e[a+1]?2:1,t++;return a<e.length&&(e[t++]=e[a]),e.subarray(0,t)}static getFrameHeaderLength(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw g(e)}}static readFrameFlags(e){return{status:{tag_alter_preservation:t.getBit(e,0,6),file_alter_preservation:t.getBit(e,0,5),read_only:t.getBit(e,0,4)},format:{grouping_identity:t.getBit(e,1,7),compression:t.getBit(e,1,3),encryption:t.getBit(e,1,2),unsynchronisation:t.getBit(e,1,1),data_length_indicator:t.getBit(e,1,0)}}}static readFrameData(e,a,t,r,i){let n=new h(t,i);switch(t){case 2:return n.readData(e,a.id,r);case 3:case 4:return a.flags?.format.unsynchronisation&&(e=m.removeUnsyncBytes(e)),a.flags?.format.data_length_indicator&&(e=e.subarray(4,e.length)),n.readData(e,a.id,r);default:throw g(t)}}static makeDescriptionTagName(e,a){return e+(a?`:${a}`:"")}async parse(e,a,t){this.tokenizer=a,this.metadata=e,this.options=t;let r=await this.tokenizer.readToken(i.ID3v2Header);if("ID3"!==r.fileIdentifier)throw new l("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=r,this.headerType=`ID3v2.${r.version.major}`,r.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(r.size)}async parseExtendedHeader(){let e=await this.tokenizer.readToken(i.ExtendedHeader),a=e.size-i.ExtendedHeader.len;return a>0?this.parseExtendedHeaderData(a,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,a){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-a)}async parseId3Data(e){let t=await this.tokenizer.readToken(new a.Uint8ArrayType(e));for(let e of this.parseMetadata(t))"TXXX"===e.id?e.value&&await this.handleTag(e,e.value.text,()=>e.value.description):await (Array.isArray(e.value)?Promise.all(e.value.map(a=>this.addTag(e.id,a))):this.addTag(e.id,e.value))}async handleTag(e,a,t,r=e=>e){await Promise.all(a.map(a=>this.addTag(m.makeDescriptionTagName(e.id,t(a)),r(a))))}async addTag(e,a){await this.metadata.addTag(this.headerType,e,a)}parseMetadata(e){let a=0,t=[];for(;a!==e.length;){let r=m.getFrameHeaderLength(this.id3Header.version.major);if(a+r>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}let i=e.subarray(a,a+r);a+=r;let n=this.readFrameHeader(i,this.id3Header.version.major),s=e.subarray(a,a+n.length);a+=n.length;let d=m.readFrameData(s,n,this.id3Header.version.major,!this.options.skipCovers,this.metadata);d&&t.push({id:n.id,value:d})}return t}readFrameHeader(e,t){let r;switch(t){case 2:(r={id:(0,u.textDecode)(e.subarray(0,3),"ascii"),length:a.UINT24_BE.get(e,3)}).id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${r.id}`);break;case 3:case 4:(r={id:(0,u.textDecode)(e.subarray(0,4),"ascii"),length:(4===t?i.UINT32SYNCSAFE:a.UINT32_BE).get(e,4),flags:m.readFrameFlags(e.subarray(8,10))}).id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${r.id}`);break;default:throw g(t)}return r}}function g(e){throw new l(`Unexpected majorVer: ${e}`)}e.s(["ID3v2Parser",()=>m],285395)},655884,e=>{"use strict";var a=e.i(317890),t=e.i(807668);e.i(635777);var r=e.i(274749),i=e.i(830651),n=e.i(563943),s=e.i(285395);let d={len:12,get:(e,t)=>({chunkID:i.FourCcToken.get(e,t),chunkSize:a.INT64_BE.get(e,t+4)})};var o=e.i(180600);let c=(0,t.default)("music-metadata:parser:aiff");class h extends(0,o.makeUnexpectedFileContentError)("DSDIFF"){}class l extends n.BasicParser{async parse(){let e=await this.tokenizer.readToken(d);if("FRM8"!==e.chunkID)throw new h("Unexpected chunk-ID");this.metadata.setAudioOnly();let a=(await this.tokenizer.readToken(i.FourCcToken)).trim();if("DSD"===a)return this.metadata.setFormat("container",`DSDIFF/${a}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(e.chunkSize-BigInt(i.FourCcToken.len));throw new h(`Unsupported DSDIFF type: ${a}`)}async readFmt8Chunks(e){for(;e>=d.len;){let a=await this.tokenizer.readToken(d);c(`Chunk id=${a.chunkID}`),await this.readData(a),e-=BigInt(d.len)+a.chunkSize}}async readData(e){c(`Reading data of chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);let t=this.tokenizer.position;switch(e.chunkID.trim()){case"FVER":{let e=await this.tokenizer.readToken(a.UINT32_LE);c(`DSDIFF version=${e}`);break}case"PROP":if("SND "!==await this.tokenizer.readToken(i.FourCcToken))throw new h("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(e.chunkSize-BigInt(i.FourCcToken.len));break;case"ID3":{let t=await this.tokenizer.readToken(new a.Uint8ArrayType(Number(e.chunkSize))),i=r.fromBuffer(t);await new s.ID3v2Parser().parse(this.metadata,i,this.options);break}case"DSD":this.metadata.format.numberOfChannels&&this.metadata.setFormat("numberOfSamples",Number(e.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.format.numberOfSamples&&this.metadata.format.sampleRate&&this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate);break;default:c(`Ignore chunk[ID=${e.chunkID}, size=${e.chunkSize}]`)}let n=e.chunkSize-BigInt(this.tokenizer.position-t);n>0&&(c(`After Parsing chunk, remaining ${n} bytes`),await this.tokenizer.ignore(Number(n)))}async handleSoundPropertyChunks(e){for(c(`Parsing sound-property-chunks, remainingSize=${e}`);e>0;){let t=await this.tokenizer.readToken(d);c(`Sound-property-chunk[ID=${t.chunkID}, size=${t.chunkSize}]`);let r=this.tokenizer.position;switch(t.chunkID.trim()){case"FS":{let e=await this.tokenizer.readToken(a.UINT32_BE);this.metadata.setFormat("sampleRate",e);break}case"CHNL":{let e=await this.tokenizer.readToken(a.UINT16_BE);this.metadata.setFormat("numberOfChannels",e),await this.handleChannelChunks(t.chunkSize-BigInt(a.UINT16_BE.len));break}case"CMPR":{let e=(await this.tokenizer.readToken(i.FourCcToken)).trim(),t=await this.tokenizer.readToken(a.UINT8),r=await this.tokenizer.readToken(new a.StringType(t,"ascii"));"DSD"===e&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${e} (${r})`);break}case"ABSS":{let e=await this.tokenizer.readToken(a.UINT16_BE),t=await this.tokenizer.readToken(a.UINT8),r=await this.tokenizer.readToken(a.UINT8),i=await this.tokenizer.readToken(a.UINT32_BE);c(`ABSS ${e}:${t}:${r}.${i}`);break}case"LSCO":{let e=await this.tokenizer.readToken(a.UINT16_BE);c(`LSCO lsConfig=${e}`);break}default:c(`Unknown sound-property-chunk[ID=${t.chunkID}, size=${t.chunkSize}]`),await this.tokenizer.ignore(Number(t.chunkSize))}let n=t.chunkSize-BigInt(this.tokenizer.position-r);n>0&&(c(`After Parsing sound-property-chunk ${t.chunkSize}, remaining ${n} bytes`),await this.tokenizer.ignore(Number(n))),e-=BigInt(d.len)+t.chunkSize,c(`Parsing sound-property-chunks, remainingSize=${e}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){let e=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",e)}}async handleChannelChunks(e){c(`Parsing channel-chunks, remainingSize=${e}`);let a=[];for(;e>=i.FourCcToken.len;){let t=await this.tokenizer.readToken(i.FourCcToken);c(`Channel[ID=${t}]`),a.push(t),e-=BigInt(i.FourCcToken.len)}return c(`Channels: ${a.join(", ")}`),a}}e.s(["DsdiffContentParseError",()=>h,"DsdiffParser",()=>l],655884)}];

//# sourceMappingURL=891d4_music-metadata_lib_90f6492c._.js.map